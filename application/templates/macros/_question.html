{% macro render_questions(questions) %}
    {% for question in questions %}
        <div class="dc-question">
            <div>
                <a href="{{ url_for('question.view', uid=question.id) }}">{{ question.title }}</a>
            </div>
            <div>{{ question.user.name }}</div>
            <div>{{ question.desc|safe }}</div>
            <div class="time" title="{{ question.created_at }}">
                {{ question.created_at|timesince }}
            </div>
        </div>
    {% endfor %}
{% endmacro %}


{% macro similar_questions(questions) %}
    {% for question in questions %}
        <div class="similar-question">
            <a href="{{ url_for('question.view', uid=question.id) }}" target="_blank">
                {{ (question.highlight_title or question.title)|safe }}
            </a>
            <span>{{ question.answers.count() }} 个回答</span>
        </div>
    {% endfor %}
{% endmacro %}


{% macro question_follow_wap(question, dark=False) %}
    {% set followed = question.followed_by_user() %}
    <div class="dc-question-follow-wap btn {% if dark %}dark{% endif %}
        {% if followed %}
            btn-default
        {% else %}
            {% if dark %}btn-dark{% else %}btn-light{% endif %}
        {% endif %}
        {% if followed %}followed{% endif %}" data-id="{{ question.id }}">
        <span class="for-follow">关注问题</span><span class="for-unfollow">不再关注</span>
        <span class="divider">|</span>
        <span class="followers-count">{{ question.followers.count() }}</span>
    </div>

    <script>
        $('.dc-question-follow-wap').onOnce('click', function () {
            var questionId = $(this).data('id');
            var followed = $(this).hasClass('followed');
            var _this = $(this);
            var $count = $(this).find('.followers-count');
            var url = urlFor('question.follow', {uid: questionId});

            if (!g.signin) {
                window.location = urlFor('account.signin');
                return;
            }

            $.ajax({
                url: url,
                method: 'post',
                dataType: 'json'
            }).done(function (response) {
                if (response.result) {
                    if (response.followed) {
                        _this.addClass('followed').addClass('btn-default');
                        if (_this.hasClass('dark')) {
                            _this.removeClass('btn-dark');
                        } else {
                            _this.removeClass('btn-light');
                        }
                    } else {
                        _this.removeClass('followed').removeClass('btn-default');

                        if (_this.hasClass('dark')) {
                            _this.addClass('btn-dark');
                        } else {
                            _this.addClass('btn-light');
                        }
                    }

                    $count.text(response.followers_count);
                }
            });
        });
    </script>
{% endmacro %}